<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pusher Flask Test</title>
  <script src="https://js.pusher.com/8.2.0/pusher.min.js"></script>
  <script>
    // Configuración de Pusher
    Pusher.logToConsole = true;

    var pusher = new Pusher('93f016bf1fd53612e9ad', {
      cluster: 'us2'
    });

    var channel = pusher.subscribe('my-channel');
    channel.bind('my-event', function(data) {
      // Insertar el mensaje recibido en la tabla
      addMessageToTable(data.message);
    });

    // Función para hacer fetch a la ruta /evento
    function sendMessage() {
      fetch('/evento', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        }
      }).then(response => response.json())
      .then(data => {
        // Mostrar el mensaje de respuesta en el cliente
        document.getElementById('response').innerText = data.message;
      }).catch(error => {
        console.error('Error:', error);
      });
    }

    // Función para agregar un mensaje a la tabla
    function addMessageToTable(message) {
      var table = document.getElementById('messageTable').getElementsByTagName('tbody')[0];
      var newRow = table.insertRow(); // Crear una nueva fila

      var cell1 = newRow.insertCell(0); // Insertar nueva celda
      var cell2 = newRow.insertCell(1); // Insertar nueva celda

      cell1.innerHTML = new Date().toLocaleString(); // Colocar la fecha y hora
      cell2.innerHTML = message; // Colocar el mensaje
    }
  </script>
</head>
<body>
  <h1>Pusher Flask Test</h1>
  <p>
    Pulsa el botón para enviar un mensaje a través del servidor Flask y Pusher.
  </p>

  <!-- Botón para enviar el mensaje -->
  <button onclick="sendMessage()">Enviar Mensaje a Todos</button>

  <!-- Tabla para mostrar los mensajes recibidos -->
  <h2>Mensajes Recibidos:</h2>
  <table id="messageTable" border="1">
    <thead>
      <tr>
        <th>Fecha y Hora</th>
        <th>Mensaje</th>
      </tr>
    </thead>
    <tbody>
      <!-- Aquí se insertarán las filas de los mensajes -->
    </tbody>
  </table>

  <!-- Donde se mostrará la respuesta del servidor Flask -->
  <h2>Respuesta del Servidor Flask:</h2>
  <pre id="response"></pre>
</body>
</html>
